<!DOCTYPE html>

<html>
    <head>
        <title>Auction WP plugin</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/epoch/0.8.4/css/epoch.min.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/epoch/0.8.4/js/epoch.min.js"></script>
    </head>
    <body>
        <div class="ui container">
            <div class="ui segment">
                <div class="ui blurring dimmer" id="errorDisplay">
                    <div class="content">
                        <div class="center">
                            <h2 class="ui inverted icon header">
                                <i class="notched circle loading icon"></i>
                                Trying to reconnect... Check your internet connection
                            </h2>
                        </div>
                    </div>
                </div>
                <br><br><br>
                <div class="ui statistic">
                    <div class="value">
                        <i class="dollar icon"></i> <span id="currentPrice"></span>,- Kč
                    </div>
                    <div class="label">
                        Aktuální nabídka
                    </div>
                </div>
                <br>
                <br>
                <div class="ui basic buttons">
                    <div class="ui button bid" data-value="5">5,- Kč</div>
                    <div class="ui button bid" data-value="10">10,- Kč</div>
                    <div class="ui button bid" data-value="500">500,- Kč</div>
                </div>
                <br><br>
                <!--<div id="realTimeDisplay" style="width: 800px; height: 200px"></div>-->
                <br><br>
            </div>
        </div>
        <script>
            $(document).ready(function () {
                (function establishConnection () {
                    var socket = new WebSocket('ws://192.168.1.23:8087/socket');
                    var loop = 0;
                    /*var chartData = [{ label: 'Nabídka', values: [ ] }];
                
                    var chartInstance = $('#realTimeDisplay').epoch({
                        type: 'time.line',
                        axes: [ 'bottom', 'left', 'right' ],
                        data: chartData
                    });*/
                
                    socket.onmessage = function (e) {
                        var data = JSON.parse(e.data);
                        $('#currentPrice').text(data.currentPrice);
                        /*chartData[0].values.shift();
                        chartData[0].values.push({
                            time: new Date(),
                            y: Number(data.currentPrice)
                        });
                        chartInstance.push(chartData);*/
                    }
                
                    socket.onopen = function () {
                        clearInterval(loop);
                        $('#errorDisplay')
                            .dimmer('hide');
                    }
                
                    socket.onclose = function () {
                        loop = setInterval(function () {
                            establishConnection();
                        }, 1000);
                        $('#errorDisplay')
                            .dimmer({
                                closable: false
                            })
                            .dimmer('show');
                    }
                
                    $('.bid').click(function () {
                        var hodnota = $(this).data('value');
                        socket.send('{"value": "' + hodnota + '"}');
                    });
                })();
            });
        </script>
    </body>
</html>
